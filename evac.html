<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Эвакуация — быстрая оценка</title>

<style>
body{
  margin:0;
  font-family: system-ui, -apple-system, Arial, sans-serif;
  background:#f4f6f8;
  color:#111;
}

header{
  background:#1f6f3d;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:18px;
  font-weight:700;
}

.container{
  padding:12px;
}

.item{
  background:#fff;
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
  display:flex;
  gap:12px;
  align-items:flex-start;
  border:1px solid #ddd;
  touch-action: pan-y;
}

.item.critical{
  border-left:6px solid #c62828;
}

.item.stable{
  border-left:6px solid #2e7d32;
}

.item input{
  width:22px;
  height:22px;
  flex-shrink:0;
  margin-top:2px;
}

.item-title{
  font-weight:600;
}

.item-desc{
  font-size:13px;
  color:#555;
  margin-top:4px;
}

.result{
  margin-top:16px;
  padding:14px;
  border-radius:14px;
  background:#fff;
  border:2px solid #ddd;
}

.result.red{ border-color:#c62828; background:#fdecea; }
.result.yellow{ border-color:#f9a825; background:#fff8e1; }
.result.green{ border-color:#2e7d32; background:#e8f5e9; }

.result h3{
  margin:0 0 8px 0;
}

button{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:14px;
  border:none;
  margin-top:12px;
  font-weight:600;
}

.btn-copy{
  background:#1976d2;
  color:#fff;
}

.btn-reset{
  background:#555;
  color:#fff;
}

.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#111;
  color:#fff;
  padding:10px 14px;
  border-radius:12px;
  font-size:14px;
  display:none;
}
</style>
</head>

<body>

<header>ЭВАКУАЦИЯ — БЫСТРАЯ ОЦЕНКА</header>

<div class="container" id="list"></div>

<div class="container">
  <div id="result" class="result green">
    <h3>Пока не оценено</h3>
    <div id="resText">Отметь пункты выше</div>
  </div>

  <button class="btn-copy" id="btnCopy">КОПИРОВАТЬ РЕЗУЛЬТАТ</button>
  <button class="btn-reset" id="btnReset">СБРОСИТЬ</button>
</div>

<div class="toast" id="toast"></div>

<script>
const ITEMS = [
  {id:"bleed", title:"Тяжёлое кровотечение", desc:"тампонада/жгут, риск срыва", score:5, critical:true},
  {id:"chest", title:"Ранение груди", desc:"клапан закрыт, риск ухудшения", score:4},
  {id:"abd", title:"Подозрение на проникающее ранение живота/таза", desc:"боль, напряжение", score:4},
  {id:"limb", title:"Серьёзная травма конечности", desc:"перелом/деформация", score:3},
  {id:"eye", title:"Проникающая травма глаза", desc:"", score:3},
  {id:"burn", title:"Ожоги 10–20% поверхности", desc:"", score:3},
  {id:"redflags", title:"Амбулаторные «красные флаги»", desc:"температура + ухудшение", score:2},
  {id:"support", title:"Нужна поддержка/наблюдение", desc:"не может идти сам", score:1},
  {id:"stable", title:"Стабильно, поверхностно", desc:"без прогрессии", score:0, stable:true}
];

const list = document.getElementById("list");
const resultBox = document.getElementById("result");
const resText = document.getElementById("resText");
const toastEl = document.getElementById("toast");

let state = {};

function toast(msg){
  toastEl.textContent = msg;
  toastEl.style.display="block";
  setTimeout(()=>toastEl.style.display="none",2000);
}

function render(){
  list.innerHTML="";
  ITEMS.forEach(it=>{
    const wrap=document.createElement("div");
    wrap.className="item";
    if(it.critical) wrap.classList.add("critical");
    if(it.stable) wrap.classList.add("stable");

    const cb=document.createElement("input");
    cb.type="checkbox";
    cb.checked=!!state[it.id];

    const box=document.createElement("div");
    box.innerHTML=`<div class="item-title">${it.title}</div>
                   <div class="item-desc">${it.desc||""}</div>`;

    let startY=0, moved=false;

    wrap.addEventListener("pointerdown",e=>{
      startY=e.clientY;
      moved=false;
    });

    wrap.addEventListener("pointermove",e=>{
      if(Math.abs(e.clientY-startY)>8) moved=true;
    });

    wrap.addEventListener("pointerup",e=>{
      if(moved) return;
      if(e.target===cb) return;
      cb.checked=!cb.checked;
      cb.dispatchEvent(new Event("change"));
    });

    cb.addEventListener("change",()=>{
      state[it.id]=cb.checked;
      recalc();
    });

    wrap.appendChild(cb);
    wrap.appendChild(box);
    list.appendChild(wrap);
  });
}

function recalc(){
  let score=0;
  let crit=false;
  let active=[];

  ITEMS.forEach(it=>{
    if(state[it.id]){
      active.push(it.title);
      score+=it.score;
      if(it.critical) crit=true;
    }
  });

  let cat="НАБЛЮДАТЬ";
  let cls="green";
  let rec="Наблюдение на месте, контроль состояния.";

  if(crit){
    cat="ЭВАКУАЦИЯ СРОЧНО";
    cls="red";
    rec="Немедленная эвакуация. Поддержка ABC, контроль кровотечения.";
  } else if(score>=6){
    cat="ЭВАКУАЦИЯ В ПРИОРИТЕТЕ";
    cls="red";
    rec="Эвакуация при первой возможности.";
  } else if(score>=3){
    cat="ЭВАКУАЦИЯ ПЛАНОВО";
    cls="yellow";
    rec="Подготовить к эвакуации, наблюдение.";
  }

  resultBox.className="result "+cls;
  resultBox.querySelector("h3").textContent=cat;
  resText.textContent=
    "Отмечено: "+(active.length||"0")+
    "\nБаллы: "+score+
    "\nПричины: "+(active.join(", ")||"—")+
    "\n\nРекомендации:\n"+rec;

  window.__EVAC_TEXT__=
`ЭВАКУАЦИЯ
Категория: ${cat}
Баллы: ${score}
Причины: ${active.join(", ")||"—"}
Рекомендации: ${rec}`;
}

document.getElementById("btnCopy").onclick=()=>{
  if(!window.__EVAC_TEXT__) return;
  navigator.clipboard.writeText(window.__EVAC_TEXT__);
  toast("Скопировано");
};

document.getElementById("btnReset").onclick=()=>{
  state={};
  render();
  recalc();
  toast("Сброшено");
};

render();
recalc();
</script>

</body>
</html>
