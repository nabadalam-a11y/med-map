<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–≠–≤–∞–∫—É–∞—Ü–∏—è ‚Äî –ë—ã—Å—Ç—Ä–∞—è –æ—Ü–µ–Ω–∫–∞</title>
<style>
  body{ margin:0; font-family: Arial, sans-serif; background:#fff; color:#111; }
  header{
    position:sticky; top:0; z-index:10;
    background:#0b6623; color:#fff;
    padding:12px 12px; text-align:center;
    font-weight:800; font-size:18px;
  }
  .sub{
    padding:10px 12px; font-size:13px; color:#333;
    background:#f4f7f5; border-bottom:1px solid #dfe7e2;
  }

  .wrap{ padding:12px; max-width:820px; margin:0 auto; }

  .card{
    border:1px solid #e6e6e6; border-radius:14px;
    background:#fff; padding:12px; margin:10px 0;
    box-shadow:0 1px 6px rgba(0,0,0,0.05);
  }
  .card h2{ margin:0 0 8px; font-size:16px; }
  .hint{ font-size:12px; color:#666; margin-top:6px; }

  .q{
    display:flex; align-items:flex-start; gap:10px;
    padding:10px; border:1px solid #eee; border-radius:12px;
    background:#fafafa; margin:10px 0;
    touch-action: manipulation;
  }
  .q input{ width:22px; height:22px; margin-top:2px; }
  .q .txt{ font-size:14px; }
  .q .small{ font-size:12px; color:#555; margin-top:4px; }

  .row{ display:flex; gap:10px; }
  .col{ width:100%; }

  label{ display:block; font-size:13px; color:#444; margin:10px 0 6px; }
  input, textarea{
    width:100%; box-sizing:border-box;
    padding:10px; font-size:15px;
    border:1px solid #ccc; border-radius:10px;
    background:#fff;
  }
  textarea{ min-height:60px; }

  .btnRow{ display:flex; gap:10px; margin-top:10px; }
  .btn{
    width:100%; padding:14px; font-size:16px;
    border:none; border-radius:12px; color:#fff;
    background:#0b6623; touch-action: manipulation;
  }
  .btn:active{ opacity:.85; }
  .btn.secondary{ background:#2a76d2; }
  .btn.light{ background:#444; }
  .btn.white{
    background:#fff; color:#111; border:1px solid #222;
  }

  .result{
    padding:12px; border-radius:14px; margin-top:10px;
    border:2px solid transparent;
  }
  .rRed{ background:#fff0f0; border-color:#d33; }
  .rYel{ background:#fff8e8; border-color:#d6a100; }
  .rGrn{ background:#eefaf0; border-color:#1a8a37; }

  .big{
    font-size:18px; font-weight:900; margin:0 0 8px;
  }
  .reasons{ font-size:14px; margin:0; white-space:pre-wrap; }

  .out{
    margin-top:10px;
    white-space:pre-wrap;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-size:12px;
    padding:10px; border:1px solid #ddd; border-radius:12px;
    background:#fff;
  }

  .toast{
    position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
    background:rgba(0,0,0,0.85); color:#fff;
    padding:10px 12px; border-radius:12px;
    font-size:14px; max-width:92%;
    z-index:9999; display:none; white-space:pre-wrap;
  }

  .reqBad{ border-color:#d11 !important; box-shadow:0 0 0 3px rgba(209,17,17,0.15); }
</style>
</head>
<body>

<header>–≠–í–ê–ö–£–ê–¶–ò–Ø ‚Äî –ë–´–°–¢–†–ê–Ø –û–¶–ï–ù–ö–ê</header>
<div class="sub">
  –û—Ç–º–µ—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Äî –ø–æ–ª—É—á–∏—à—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —ç–≤–∞–∫—É–∞—Ü–∏–∏ + –ø—Ä–∏—á–∏–Ω—ã + –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏.
  –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω.
</div>

<div class="wrap">

  <div class="card">
    <h2>–î–∞–Ω–Ω—ã–µ (–¥–ª—è —Ç–µ–∫—Å—Ç–∞)</h2>
    <div class="row">
      <div class="col">
        <label>–î–∞—Ç–∞/–≤—Ä–µ–º—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <input id="dt" type="datetime-local">
      </div>
      <div class="col">
        <label>–ü–æ–∑—ã–≤–Ω–æ–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <input id="call" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ë–ê–†–°-12">
      </div>
    </div>
    <label>–ö—Ä–∞—Ç–∫–æ —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
    <textarea id="brief" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –æ—Å–∫–æ–ª–æ—á–Ω–æ–µ, –ø–µ—Ä–≤–∏—á–Ω–∞—è –ø–æ–º–æ—â—å –æ–∫–∞–∑–∞–Ω–∞, –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è..."></textarea>
    <div class="hint">–ë–µ–∑ —ç—Ç–∏—Ö –ø–æ–ª–µ–π –Ω–µ –¥–∞–¥–∏–º –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å/Telegram ‚Äî —á—Ç–æ–±—ã –Ω–µ —É—Ö–æ–¥–∏–ª–∏ –ø—É—Å—Ç—ã–µ –¥–æ–∫–ª–∞–¥—ã.</div>
  </div>

  <div class="card">
    <h2>–û—Ç–º–µ—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ (–î–ê/–ù–ï–¢)</h2>

    <!-- –ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ -->
    <div class="q">
      <input type="checkbox" id="q_bleed_uncontrolled">
      <div class="txt">
        <div><b>–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –ù–ï –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è</b> (–∂–≥—É—Ç/–¥–∞–≤—è—â–∞—è –Ω–µ –¥–µ—Ä–∂–∏—Ç, ‚Äú–ª—å—ë—Ç‚Äù)</div>
        <div class="small">‚Üí —ç–≤–∞–∫—É–∞—Ü–∏—è –°–ï–ô–ß–ê–°</div>
      </div>
    </div>

    <div class="q">
      <input type="checkbox" id="q_airway_problem">
      <div class="txt">
        <div><b>–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏</b> (—É–≥—Ä–æ–∑–∞ –æ–±—Å—Ç—Ä—É–∫—Ü–∏–∏, –Ω–µ –¥–µ—Ä–∂–∏—Ç —è–∑—ã–∫, —Ö—Ä–∏–ø—ã/—Å—Ä—ã–≤)</div>
        <div class="small">‚Üí —ç–≤–∞–∫—É–∞—Ü–∏—è –°–ï–ô–ß–ê–°</div>
      </div>
    </div>

    <div class="q">
      <input type="checkbox" id="q_resp_fail">
      <div class="txt">
        <div><b>–î—ã—Ö–∞–Ω–∏–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è</b> (–Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç –æ–¥—ã—à–∫–∞/—Ü–∏–∞–Ω–æ–∑/–∞—Å–∏–º–º–µ—Ç—Ä–∏—è, –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–π –ø–Ω–µ–≤–º–æ)</div>
        <div class="small">‚Üí —ç–≤–∞–∫—É–∞—Ü–∏—è –°–ï–ô–ß–ê–°</div>
      </div>
    </div>

    <div class="q">
      <input type="checkbox" id="q_shock_signs">
      <div class="txt">
        <div><b>–ü—Ä–∏–∑–Ω–∞–∫–∏ —à–æ–∫–∞</b> (–ø–æ—Ö–æ–ª–æ–¥–∞–Ω–∏–µ, –±–ª–µ–¥–Ω–æ—Å—Ç—å, —Å–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å, —Å–ª–∞–±—ã–π –ø—É–ª—å—Å, —É—Ö—É–¥—à–∞–µ—Ç—Å—è)</div>
        <div class="small">‚Üí —ç–≤–∞–∫—É–∞—Ü–∏—è –°–ï–ô–ß–ê–°</div>
      </div>
    </div>

    <div class="q">
      <input type="checkbox" id="q_conscious_down">
      <div class="txt">
        <div><b>–°–æ–∑–Ω–∞–Ω–∏–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è</b> (–æ–≥–ª—É—à–µ–Ω–∏–µ/–ø–æ—Ç–µ—Ä—è/—Å—É–¥–æ—Ä–æ–≥–∏/–Ω–∞—Ä–∞—Å—Ç–∞–µ—Ç —Å–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å)</div>
        <div class="small">‚Üí —ç–≤–∞–∫—É–∞—Ü–∏—è –°–ï–ô–ß–ê–°</div>
      </div>
    </div>

    <!-- –ñ—ë–ª—Ç—ã–µ —Ñ–ª–∞–≥–∏ -->
    <div class="q">
      <input type="checkbox" id="q_bleed_controlled">
      <div class="txt">
        <div><b>–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è, –Ω–æ —Ç—è–∂—ë–ª–æ–µ</b> (–∂–≥—É—Ç/—Ç–∞–º–ø–æ–Ω–∞–¥–∞ –µ—Å—Ç—å, —Ä–∏—Å–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ)</div>
        <div class="small">‚Üí –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</div>
      </div>
    </div>

    <div class="q">
      <input type="checkbox" id="q_chest_wound">
      <div class="txt">
        <div><b>–†–∞–Ω–µ–Ω–∏–µ –≥—Ä—É–¥–∏</b> (–∑–∞–∫—Ä—ã—Ç–æ/–∫–ª–∞–ø–∞–Ω, –Ω–æ —Ä–∏—Å–∫ —É—Ö—É–¥—à–µ–Ω–∏—è)</div>
        <div class="small">‚Üí –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ / –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏</div>
      </div>
    </div>

    <div class="q">
      <input type="checkbox" id="q_fracture_major">
      <div class="txt">
        <div><b>–°–µ—Ä—å—ë–∑–Ω–∞—è —Ç—Ä–∞–≤–º–∞ –∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏</b> (–ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–µ–ª–æ–º, —Å–∏–ª—å–Ω–∞—è –±–æ–ª—å/–¥–µ—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω—É–∂–Ω–∞ —Ö–∏—Ä—É—Ä–≥–∏—è)</div>
        <div class="small">‚Üí –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</div>
      </div>
    </div>

    <div class="q">
      <input type="checkbox" id="q_infection_redflags">
      <div class="txt">
        <div><b>–ê–º–±—É–ª–∞—Ç–æ—Ä–Ω—ã–µ ‚Äú–∫—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏‚Äù</b> (–≤—ã—Å–æ–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ + —É—Ö—É–¥—à–µ–Ω–∏–µ, –±—ã—Å—Ç—Ä–æ–µ –ø–æ–∫—Ä–∞—Å–Ω–µ–Ω–∏–µ/–æ—Ç—ë–∫, –≥–Ω–æ–π + —Å–ª–∞–±–æ—Å—Ç—å)</div>
        <div class="small">‚Üí –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</div>
      </div>
    </div>

    <!-- –ó–µ–ª–µ–Ω—ã–µ -->
    <div class="q">
      <input type="checkbox" id="q_stable_minor">
      <div class="txt">
        <div><b>–°—Ç–∞–±–∏–ª—å–Ω–æ, –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ</b> (–∫–æ–Ω—Ç—Ä–æ–ª—å, –Ω–µ—Ç —É—Ö—É–¥—à–µ–Ω–∏—è)</div>
        <div class="small">‚Üí –º–æ–∂–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å –Ω–∞ –º–µ—Å—Ç–µ</div>
      </div>
    </div>

    <div class="hint">
      –õ–æ–≥–∏–∫–∞: –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫—Ä–∞—Å–Ω—ã–π —Ñ–ª–∞–≥ ‚Üí üî¥ –°–ï–ô–ß–ê–°.
      –ï—Å–ª–∏ –∫—Ä–∞—Å–Ω—ã—Ö –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –∂—ë–ª—Ç—ã–µ ‚Üí üü° –ü–†–ò –ü–ï–†–í–û–ô –í–û–ó–ú–û–ñ–ù–û–°–¢–ò.
      –ï—Å–ª–∏ –æ—Ç–º–µ—á–µ–Ω–æ —Ç–æ–ª—å–∫–æ ‚Äú—Å—Ç–∞–±–∏–ª—å–Ω–æ‚Äù ‚Üí üü¢ –ù–ê–ë–õ–Æ–î–ê–¢–¨.
    </div>
  </div>

  <div class="card">
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
    <div id="resultBox" class="result rGrn">
      <div id="resultTitle" class="big">–ü–æ–∫–∞ –Ω–µ –æ—Ü–µ–Ω–µ–Ω–æ</div>
      <p id="resultReasons" class="reasons">–û—Ç–º–µ—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤—ã—à–µ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
    </div>

    <div class="btnRow">
      <button class="btn" id="btnCopy" type="button">–ö–û–ü–ò–†–û–í–ê–¢–¨ –¢–ï–ö–°–¢</button>
      <button class="btn secondary" id="btnTG" type="button">TELEGRAM</button>
    </div>
    <button class="btn white" id="btnReset" type="button">–°–ë–†–û–°–ò–¢–¨ –û–¢–ú–ï–¢–ö–ò</button>

    <div class="out" id="finalText"></div>
  </div>

  <div class="card">
    <h2>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h2>
    <div class="btnRow">
      <button class="btn light" type="button" onclick="window.location.href='index.html'">‚¨ÖÔ∏è –ö –ö–ê–†–¢–ï –†–ê–ù–ï–ù–ò–ô</button>
      <button class="btn light" type="button" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚¨ÜÔ∏è –í–í–ï–†–•</button>
    </div>
    <div class="hint">–§–∞–π–ª –æ—Ñ–ª–∞–π–Ω. –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —Ä—è–¥–æ–º —Å –∫–∞—Ä—Ç–æ–π –∏ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ –∫–Ω–æ–ø–∫–µ.</div>
  </div>

</div>

<div id="toast" class="toast"></div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const toastEl = $("toast");

  function toast(msg, ms){
    toastEl.textContent = msg;
    toastEl.style.display = "block";
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(()=>{ toastEl.style.display="none"; }, ms || 2400);
  }

  // –ê–≤—Ç–æ-–≤—Ä–µ–º—è
  const dtEl = $("dt");
  if(!dtEl.value){
    const d=new Date();
    const pad=(n)=>String(n).padStart(2,"0");
    dtEl.value = `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }

  const callEl = $("call");
  const briefEl = $("brief");

  function markReq(el, ok){
    if(ok) el.classList.remove("reqBad"); else el.classList.add("reqBad");
  }
  function validateRequired(){
    const dt=(dtEl.value||"").trim();
    const call=(callEl.value||"").trim();
    const brief=(briefEl.value||"").trim();
    const okDt=!!dt, okCall=!!call, okBrief=!!brief;
    markReq(dtEl, okDt);
    markReq(callEl, okCall);
    markReq(briefEl, okBrief);
    const miss=[];
    if(!okDt) miss.push("–î–∞—Ç–∞/–≤—Ä–µ–º—è");
    if(!okCall) miss.push("–ü–æ–∑—ã–≤–Ω–æ–π");
    if(!okBrief) miss.push("–ö—Ä–∞—Ç–∫–æ —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ");
    return {ok: okDt && okCall && okBrief, missing: miss};
  }

  const QUESTIONS = [
    {id:"q_bleed_uncontrolled", kind:"red",  reason:"–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è"},
    {id:"q_airway_problem",     kind:"red",  reason:"–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø—É—Ç—è–º–∏"},
    {id:"q_resp_fail",          kind:"red",  reason:"–î—ã—Ö–∞–Ω–∏–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è / –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –Ω–∞–ø—Ä—è–∂—ë–Ω–Ω—ã–π –ø–Ω–µ–≤–º–æ"},
    {id:"q_shock_signs",        kind:"red",  reason:"–ü—Ä–∏–∑–Ω–∞–∫–∏ —à–æ–∫–∞ / —É—Ö—É–¥—à–µ–Ω–∏–µ"},
    {id:"q_conscious_down",     kind:"red",  reason:"–°–æ–∑–Ω–∞–Ω–∏–µ —É—Ö—É–¥—à–∞–µ—Ç—Å—è"},

    {id:"q_bleed_controlled",   kind:"yel",  reason:"–¢—è–∂—ë–ª–æ–µ –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º (—Ä–∏—Å–∫ —Å—Ä—ã–≤–∞)"},
    {id:"q_chest_wound",        kind:"yel",  reason:"–†–∞–Ω–µ–Ω–∏–µ –≥—Ä—É–¥–∏ (—Ä–∏—Å–∫ —É—Ö—É–¥—à–µ–Ω–∏—è)"},
    {id:"q_fracture_major",     kind:"yel",  reason:"–°–µ—Ä—å—ë–∑–Ω–∞—è —Ç—Ä–∞–≤–º–∞ –∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏ / –Ω—É–∂–Ω–∞ —Ö–∏—Ä—É—Ä–≥–∏—è"},
    {id:"q_infection_redflags", kind:"yel",  reason:"–ò–Ω—Ñ–µ–∫—Ü–∏—è/—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Å –∫—Ä–∞—Å–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏"},

    {id:"q_stable_minor",       kind:"grn",  reason:"–°—Ç–∞–±–∏–ª—å–Ω–æ, –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ, –±–µ–∑ —É—Ö—É–¥—à–µ–Ω–∏—è"}
  ];

  function calcCategory(){
    const picked = [];
    for(const q of QUESTIONS){
      const el = $(q.id);
      if(el && el.checked) picked.push(q);
    }

    const hasRed = picked.some(x=>x.kind==="red");
    const hasYel = picked.some(x=>x.kind==="yel");
    const hasGrn = picked.some(x=>x.kind==="grn");

    let cat = "none";
    if(hasRed) cat = "RED";
    else if(hasYel) cat = "YEL";
    else if(hasGrn) cat = "GRN";

    // –ø—Ä–∏—á–∏–Ω—ã ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ –≤—ã–±—Ä–∞–Ω—ã
    const reasons = picked.map(x=>x.reason);

    return {cat, reasons};
  }

  function catTitle(cat){
    if(cat==="RED") return "üî¥ –≠–í–ê–ö–£–ê–¶–ò–Ø –°–ï–ô–ß–ê–°";
    if(cat==="YEL") return "üü° –≠–í–ê–ö–£–ê–¶–ò–Ø –ü–†–ò –ü–ï–†–í–û–ô –í–û–ó–ú–û–ñ–ù–û–°–¢–ò";
    if(cat==="GRN") return "üü¢ –ú–û–ñ–ù–û –ù–ê–ë–õ–Æ–î–ê–¢–¨ –ù–ê –ú–ï–°–¢–ï";
    return "–ü–æ–∫–∞ –Ω–µ –æ—Ü–µ–Ω–µ–Ω–æ";
  }

  function catNote(cat){
    if(cat==="RED") return "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ –º–µ—Å—Ç—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ –∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —ç–≤–∞–∫—É–∞—Ü–∏—è.";
    if(cat==="YEL") return "–°—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —É—Ö—É–¥—à–µ–Ω–∏–µ. –≠–≤–∞–∫—É–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.";
    if(cat==="GRN") return "–ù–∞–±–ª—é–¥–µ–Ω–∏–µ, –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–∏–º–ø—Ç–æ–º–æ–≤. –ü—Ä–∏ —É—Ö—É–¥—à–µ–Ω–∏–∏ ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é.";
    return "–û—Ç–º–µ—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤—ã—à–µ.";
  }

  function buildText(cat, reasons){
    const dt=(dtEl.value||"").trim();
    const call=(callEl.value||"").trim();
    const brief=(briefEl.value||"").trim();

    const reasonsText = reasons.length ? reasons.map(r=>"‚Ä¢ "+r).join("\n") : "‚Ä¢ (–Ω–µ —É–∫–∞–∑–∞–Ω—ã)";

    return (
`–≠–í–ê–ö–£–ê–¶–ò–Ø: ${catTitle(cat)}
–î–∞—Ç–∞/–≤—Ä–µ–º—è: ${dt || "-"}
–ü–æ–∑—ã–≤–Ω–æ–π: ${call || "-"}

–ö—Ä–∞—Ç–∫–æ:
${brief || "-"}

–ü—Ä–∏—á–∏–Ω—ã:
${reasonsText}

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
${catNote(cat)}`
    );
  }

  const resultBox = $("resultBox");
  const resultTitle = $("resultTitle");
  const resultReasons = $("resultReasons");
  const finalText = $("finalText");

  function render(){
    const {cat, reasons} = calcCategory();

    resultBox.classList.remove("rRed","rYel","rGrn");
    if(cat==="RED") resultBox.classList.add("rRed");
    else if(cat==="YEL") resultBox.classList.add("rYel");
    else resultBox.classList.add("rGrn");

    resultTitle.textContent = catTitle(cat);
    resultReasons.textContent = (reasons.length ? ("–ü—Ä–∏—á–∏–Ω—ã:\n- " + reasons.join("\n- ")) : "–ü—Ä–∏—á–∏–Ω—ã: (–Ω–µ—Ç)") + "\n\n" + catNote(cat);

    finalText.textContent = buildText(cat, reasons);
  }

  for(const q of QUESTIONS){
    const el = $(q.id);
    if(el) el.addEventListener("change", render);
  }
  dtEl.addEventListener("change", render);
  callEl.addEventListener("input", render);
  briefEl.addEventListener("input", render);

  $("btnCopy").addEventListener("pointerdown", async (e)=>{
    e.preventDefault();
    const v = validateRequired();
    if(!v.ok){ toast("–ó–∞–ø–æ–ª–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:\n- " + v.missing.join("\n- "), 3200); return; }
    const {cat, reasons} = calcCategory();
    const text = buildText(cat, reasons);
    try{
      await navigator.clipboard.writeText(text);
      toast("‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ");
    }catch(_){
      toast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –í—ã–¥–µ–ª–∏ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é.", 3200);
    }
  });

  $("btnTG").addEventListener("pointerdown",(e)=>{
    e.preventDefault();
    const v = validateRequired();
    if(!v.ok){ toast("–ó–∞–ø–æ–ª–Ω–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:\n- " + v.missing.join("\n- "), 3200); return; }

    const {cat, reasons} = calcCategory();
    const text = buildText(cat, reasons);

    const tgApp = "tg://msg_url?url=&text=" + encodeURIComponent(text);
    const tgWeb = "https://t.me/share/url?url=&text=" + encodeURIComponent(text);

    // –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    const a=document.createElement("a");
    a.href=tgApp; a.style.display="none";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    // fallback
    setTimeout(()=>{ try{ window.open(tgWeb, "_blank"); }catch(_){ } }, 700);
    toast("–û—Ç–∫—Ä—ã–≤–∞—é Telegram‚Ä¶", 1600);
  });

  $("btnReset").addEventListener("pointerdown",(e)=>{
    e.preventDefault();
    for(const q of QUESTIONS){
      const el = $(q.id);
      if(el) el.checked = false;
    }
    render();
    toast("–°–±—Ä–æ—à–µ–Ω–æ");
  });

  // INIT
  render();
})();
</script>

</body>
</html>
