<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ö–∞—Ä—Ç–∞ —Ä–∞–Ω–µ–Ω–∏–π</title>

  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #fff; color: #111; }
    .title { padding: 10px; text-align: center; font-weight: 700; font-size: 18px; }
    .topStatus { padding: 10px 12px; font-size: 14px; background: #dff7df; border-bottom: 1px solid #a9d9a9; color: #333; white-space: pre-wrap; }
    .topStatus.bad { background: #ffe1e1; border-bottom: 1px solid #f0a6a6; color: #8a1f1f; }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫, –∫–∞—Ä—Ç –∏ –ø–∞–Ω–µ–ª–µ–π */
    .panel { padding: 12px; border-top: 1px solid #ddd; background: #fafafa; }
    .btn2 {
      width: 100%; padding: 12px; font-size: 16px; border: 1px solid #222;
      background: #fff; color: #222; border-radius: 10px; margin-top: 10px;
      touch-action: manipulation;
    }
    .btn2:active { opacity: .85; }
    .btn2:disabled { opacity: .55; }
    .bar { display: flex; gap: 10px; padding: 10px 12px; border-top: 1px solid #ddd;
      background: #fafafa; position: sticky; bottom: 0; z-index: 30; }
    .bar button { width: 100%; padding: 14px; font-size: 16px; border: none; border-radius: 10px;
      color: #fff; background: #0b6623; touch-action: manipulation; }
    .bar button:active { opacity: .85; }
    .bar .tg { background: #2a76d2; }
    .miniRow{
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    .miniRow .btn2{ margin-top:0; }
    #toast{
      position:fixed; left:50%; bottom:16px; transform:translateX(-50%);
      background:rgba(0,0,0,0.85); color:#fff; padding:10px 12px; border-radius:12px;
      font-size:14px; max-width:92%; z-index:9999; display:none; white-space:pre-wrap;
    }
  </style>
</head>

<body>
  <div class="title">–ö–ê–†–¢–ê –†–ê–ù–ï–ù–ò–ô –ò –°–ö–õ–ê–î –ú–ï–î–ò–ö–ê–ú–ï–ù–¢–û–í</div>
  <div id="topStatus" class="topStatus">JS: OK</div>

  <div class="tabs">
    <button class="tab" id="btnFront" type="button">–ü–ï–†–ï–î</button>
    <button class="tab" id="btnBack" type="button">–°–ü–ò–ù–ê</button>
  </div>

  <div class="wrap">
    <img id="bodyImage" class="map" src="body_front.png" alt="body">
    <div id="pinsLayer"></div>
  </div>

  <div class="panel">
    <div class="row">
      <div class="col">
        <label>–î–∞—Ç–∞/–≤—Ä–µ–º—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <input id="dt" type="datetime-local"/>
      </div>
      <div class="col">
        <label>–ü–æ–∑—ã–≤–Ω–æ–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <input id="call" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ë–ê–†–°-12"/>
      </div>
    </div>

    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
    <textarea id="comment" placeholder="–∫—Ä–∞—Ç–∫–æ..."></textarea>

    <div class="row" style="margin-top:10px;">
      <div class="col">
        <label>–í–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä –∑–æ–Ω—ã (–¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç–æ—Ä–æ–Ω—ã)</label>
        <input id="zoneNum" type="number" inputmode="numeric" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 12"/>
        <div class="hint">–ù–∞–∂–º–∏ ‚Äú–î–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å‚Äù ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å.</div>
      </div>
      <div class="col" style="display:flex;align-items:flex-end;">
        <button class="btn2" id="btnAddZone" type="button" style="margin-top:0;">–î–û–ë–ê–í–ò–¢–¨/–£–ë–†–ê–¢–¨</button>
      </div>
    </div>

    <div class="hint" style="margin-top:10px;">
      –¢–µ–ø–µ—Ä—å –õ–ï–í–û/–ü–†–ê–í–û –µ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –∑–æ–Ω, –∫—Ä–æ–º–µ:
      <b>–ü–æ–∑–≤–æ–Ω–æ—á–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏</b> –∏ <b>–ü—É–ø–æ—á–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏</b>.
      <br/>üéÅ –ù–æ–≤–∞—è —Ñ–∏—à–∫–∞: –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–æ–Ω—ã —Å—Ç–æ—Ä–æ–Ω–∞ —Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –ø–æ–ª–æ–∂–µ–Ω–∏—é –º–µ—Ç–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞) ‚Äî –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∫–Ω–æ–ø–∫–∞–º–∏.
    </div>

    <div id="zonesUI"></div>

    <div class="miniRow">
      <button class="btn2" id="btnRefresh" type="button">–û–ë–ù–û–í–ò–¢–¨ –û–¢–ß–Å–¢</button>
      <button class="btn2" id="btnCopy" type="button">–ö–û–ü–ò–†–û–í–ê–¢–¨</button>
    </div>

    <button class="btn2" id="btnShort" type="button">–ö–û–†–û–¢–ö–ê–Ø –°–í–û–î–ö–ê (–¥–ª—è —Ä–∞—Ü–∏–∏)</button>

    <div class="out" id="finalMsg"></div>
  </div>

  <div class="bar">
    <button id="btnMakePDF" type="button">–°–î–ï–õ–ê–¢–¨ PDF (2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã)</button>
    <button id="btnTG" class="tg" type="button">TELEGRAM</button>
    <button id="btnHelp" type="button" style="background:#444;">–ò–ù–°–¢–†–£–ö–¶–ò–Ø</button>
    <button type="button" style="background:#444;" onclick="location.href='./evac.html'">–≠–í–ê–ö–£–ê–¶–ò–Ø</button>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–∫–ª–∞–¥ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤ -->
  <div style="text-align: center; margin-top: 20px;">
    <a href="med_inventory.html">
      <button style="padding: 12px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer;">
        –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∫–ª–∞–¥ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤
      </button>
    </a>
  </div>

<script>
// === –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∏ –∑–æ–Ω—ã ===
const BACK = {
  1: "–ü–æ–¥–æ—à–≤–∞", 2: "–¢—ã–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å—Ç–æ–ø—ã", 3: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –≥–æ–ª–µ–Ω–∏", 4: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –≥–æ–ª–µ–Ω–∏",
  5: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –∫–æ–ª–µ–Ω–∞", 6: "–ó–∞–¥–Ω–µ–ø—Ä–æ—Ö–æ–¥–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 7: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –±–µ–¥—Ä–∞", 8: "–ö—Ä–µ—Å—Ç—Ü–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å",
  9: "–Ø–≥–æ–¥–∏—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 10: "–ë–æ–∫–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å –∂–∏–≤–æ—Ç–∞", 11: "–ü–æ—è—Å–Ω–∏—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 12: "–ü–æ–∑–≤–æ–Ω–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å",
  13: "–ü–æ–¥–ª–æ–ø–∞—Ç–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 14: "–ó–∞–¥–Ω—è—è –ª–æ–∫—Ç–µ–≤–∞—è –æ–±–ª–∞—Å—Ç—å", 15: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø–ª–µ—á–∞", 16: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø—Ä–µ–¥–ø–ª–µ—á—å—è",
  17: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø–ª–µ—á–∞", 18: "–¢—ã–ª –∫–∏—Å—Ç–∏", 19: "–ù–∞–¥–ª–æ–ø–∞—Ç–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 20: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å —à–µ–∏",
  21: "–ó–∞—Ç—ã–ª–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 22: "–°–∫—É–ª–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å", 23: "–¢–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 24: "–í–∏—Å–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å",
  25: "–õ–æ–±–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 26: "–ì–ª–∞–∑–Ω–∏—Ü–∞", 27: "–©—ë—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 28: "–ü–æ–¥–Ω–∏–∂–Ω–µ—á–µ–ª—é—Å—Ç–Ω–æ–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫",
  29: "–ì—Ä—É–¥–∏–Ω–æ-–∫–ª—é—á–∏—á–Ω–æ-—Å–æ—Å—Ü–µ–≤–∏–¥–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 30: "–ê–∫—Ä–æ–º–∏–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 31: "–ú–µ–∂–ª–æ–ø–∞—Ç–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å",
  32: "–î–µ–ª—å—Ç–æ–≤–∏–¥–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 33: "–õ–æ–ø–∞—Ç–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 34: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø–ª–µ—á–∞", 35: "–õ–∞—Ç–µ—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –≥—Ä—É–¥–∏",
  36: "–ó–∞–¥–Ω—è—è –ª–æ–∫—Ç–µ–≤–∞—è –æ–±–ª–∞—Å—Ç—å", 37: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø—Ä–µ–¥–ø–ª–µ—á—å—è", 38: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø—Ä–µ–¥–ø–ª–µ—á—å—è",
  39: "–ö–∏—Å—Ç—å, –ª–∞–¥–æ–Ω—å", 40: "–ü–æ–¥—Ä—ë–±–µ—Ä–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 41: "–ü—è—Ç–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å"
};
const FRONT = {
  1: "–ü—É–ø–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 2: "–ü–æ–¥—á—Ä–µ–≤–Ω–∞—è (–ª–æ–±–∫–æ–≤–∞—è) –æ–±–ª–∞—Å—Ç—å", 3: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø—Ä–µ–¥–ø–ª–µ—á—å—è", 4: "–¢—ã–ª –∫–∏—Å—Ç–∏",
  5: "–ü—Ä–µ–¥–ø–ª–µ—á—å–µ", 6: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø—Ä–µ–¥–ø–ª–µ—á—å—è", 7: "–ó–∞–¥–Ω—è—è –ª–æ–∫—Ç–µ–≤–∞—è –æ–±–ª–∞—Å—Ç—å", 8: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø–ª–µ—á–∞",
  9: "–ì—Ä—É–¥–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 10: "–î–µ–ª—å—Ç–æ–≤–∏–¥–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 11: "–ö–ª—é—á–∏—á–Ω–æ-–≥—Ä—É–¥–Ω–æ–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫",
  12: "–ì—Ä—É–¥–∏–Ω–æ-–∫–ª—é—á–∏—á–Ω–æ-—Å–æ—Å—Ü–µ–≤–∏–¥–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 13: "–û–±–ª–∞—Å—Ç—å —Ä—Ç–∞", 14: "–û–±–ª–∞—Å—Ç—å –Ω–æ—Å–∞",
  15: "–í–∏—Å–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 16: "–ì–ª–∞–∑–Ω–∏—Ü–∞", 17: "–õ–æ–±–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 18: "–¢–µ–º–µ–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å",
  19: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å —à–µ–∏", 20: "–ü–æ–¥–±–æ—Ä–æ–¥–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 21: "–õ–∞—Ç–µ—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —à–µ–∏", 22: "–û–±–ª–∞—Å—Ç—å –∫–ª—é—á–∏—Ü—ã",
  23: "–ü–æ–¥–∫–ª—é—á–∏—á–Ω–∞—è —è–º–∫–∞", 24: "–õ–∞–¥–æ–Ω—å", 25: "–ü–µ—Ä–µ–¥–Ω—è—è –ª–æ–∫—Ç–µ–≤–∞—è –æ–±–ª–∞—Å—Ç—å", 26: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –ø–ª–µ—á–∞",
  27: "–ü–æ–¥–º—ã—à–µ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 28: "–ì—Ä—É–¥–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 29: "–ü–æ–¥—Ä—ë–±–µ—Ä–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 30: "–ù–∞–¥—á—Ä–µ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å",
  31: "–ë–æ–∫–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å –∂–∏–≤–æ—Ç–∞", 32: "–ü–∞—Ö–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å", 33: "–ë–µ–¥—Ä–µ–Ω–Ω—ã–π —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫", 34: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –±–µ–¥—Ä–∞",
  35: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –∫–æ–ª–µ–Ω–∞", 36: "–ó–∞–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –≥–æ–ª–µ–Ω–∏", 37: "–ü–µ—Ä–µ–¥–Ω—è—è –æ–±–ª–∞—Å—Ç—å –≥–æ–ª–µ–Ω–∏",
  38: "–ü–µ—Ä–µ–¥–Ω—è—è –≥–æ–ª–µ–Ω–æ—Å—Ç–æ–ø–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 39: "–ü—è—Ç–æ—á–Ω–∞—è –æ–±–ª–∞—Å—Ç—å", 40: "–¢—ã–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å—Ç–æ–ø—ã"
};

// === –•–†–ê–ù–ò–õ–ò–©–ï (–ó–æ–Ω—ã –∏ –º–µ—Ç–∫–∏) ===
const POINTS_KEY="medmap_points_v2";
const SEL_FRONT="medmap_sel_front_v4";
const SEL_BACK="medmap_sel_back_v4";
const META_FRONT="medmap_meta_front_v4";
const META_BACK="medmap_meta_back_v4";

// —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
function loadJSON(key, fallback){ try{ const raw=localStorage.getItem(key); return raw?JSON.parse(raw):fallback; }catch(_){ return fallback; } }
function saveJSON(key,val){ localStorage.setItem(key, JSON.stringify(val)); }

function loadPoints(){ const p=loadJSON(POINTS_KEY,{front:{},back:{}}); if(!p.front) p.front={}; if(!p.back) p.back={}; return p; }
function loadSel(side){ const key = side==="front"?SEL_FRONT:SEL_BACK; const arr=loadJSON(key,[]); return Array.isArray(arr)?arr.map(String):[]; }
function saveSel(side,arr){ const key = side==="front"?SEL_FRONT:SEL_BACK; saveJSON(key,arr); }
function loadMeta(side){ const key = side==="front"?META_FRONT:META_BACK; const obj=loadJSON(key,{}); return (obj && typeof obj==="object")?obj:{}; }
function saveMeta(side,obj){ const key = side==="front"?META_FRONT:META_BACK; saveJSON(key,obj); }

function dictFor(side){ return side==="front"?FRONT:BACK; }

function clearPins(){ pinsLayer.innerHTML=""; }

function addPin(num,x,y,selected){
  const pin=document.createElement("div");
  pin.className="pin " + (view==="front"?"front":"back") + (selected?" selected":"");
  pin.style.left=x+"%";
  pin.style.top=y+"%";
  pin.textContent=String(num);

  pin.addEventListener("pointerdown",(e)=>{
    e.preventDefault(); e.stopPropagation();
    toggleZone(num);
  });

  pinsLayer.appendChild(pin);
}

// === –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ===
function renderPins(){
  const points=loadPoints();
  const map=view==="front"?points.front:points.back;
  const sel=loadSel(view);
  const selSet={}; for(let i=0;i<sel.length;i++) selSet[sel[i]]=1;

  clearPins();
  for(let i=0;i<sel.length;i++){
    const k=sel[i];
    if(map[k]) addPin(k, map[k].x, map[k].y, true);
  }
  const keys=Object.keys(map);
  for(let i=0;i<keys.length;i++){
    const k=keys[i];
    if(!selSet[k] && map[k]) addPin(k, map[k].x, map[k].y, false);
  }
}

function toggleZone(num){
  const n=String(parseInt(num,10));
  let sel=loadSel(view);

  let idx=-1;
  for(let i=0;i<sel.length;i++){ if(sel[i]===n){ idx=i; break; } }

  if(idx>=0){
    sel.splice(idx,1);
    saveSel(view, uniqNums(sel));
    renderAll();
    return;
  }

  // –¥–æ–±–∞–≤–∏—Ç—å
  sel.push(n);
  saveSel(view, uniqNums(sel));
  renderAll();
}

// ===== –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ =====
function init(){
  setView("front");
  renderPins();
}
init();
</script>
</body>
</html>
