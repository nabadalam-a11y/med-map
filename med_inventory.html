<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–°–∫–ª–∞–¥ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤</title>
  <style>
    :root{
      --bg:#f4f6f8;
      --card:#fff;
      --text:#111;
      --muted:#556;
      --green:#1f6f3d;
      --red:#b71c1c;
      --amber:#f9a825;
      --blue:#1976d2;
      --line:#d9dde3;
      --shadow: 0 1px 10px rgba(0,0,0,0.06);
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--text);}
    header{
      position:sticky;top:0;z-index:20;
      background:linear-gradient(0deg, rgba(0,0,0,0.06), rgba(0,0,0,0.06)), var(--blue);
      color:#fff;padding:12px 14px;
      box-shadow:var(--shadow);
    }
    header .t{font-size:18px;font-weight:900;text-align:center;letter-spacing:.2px}
    header .sub{margin-top:6px;font-size:12px;opacity:.9;text-align:center;line-height:1.25}

    .wrap{padding:12px;max-width:900px;margin:0 auto;}
    .panel{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      box-shadow:var(--shadow);
      margin-top:12px;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1 1 160px}

    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}
    input{
      width:100%;box-sizing:border-box;
      padding:12px 12px;font-size:16px;
      border:1px solid var(--line);border-radius:14px;
      background:#fff;outline:none;
    }
    input:focus{border-color:rgba(25,118,210,.5);box-shadow:0 0 0 3px rgba(25,118,210,.12);}

    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    button{
      border:none;border-radius:14px;
      padding:14px 14px;font-weight:900;font-size:15px;
      touch-action:manipulation;
      box-shadow:var(--shadow);
      cursor:pointer;
    }
    button:active{opacity:.86}
    .bBlue{background:var(--blue);color:#fff}
    .bGreen{background:var(--green);color:#fff}
    .bGray{background:#515a63;color:#fff}
    .bOutline{background:#fff;color:#111;border:1px solid var(--line)}
    .tiny{font-size:12px;padding:10px 12px;border-radius:12px;box-shadow:none}

    .metaLine{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.25}
    .badge{
      display:inline-block;
      font-size:12px;font-weight:900;border-radius:999px;padding:6px 10px;
      background:#eef2f6;color:#223;border:1px solid var(--line);
      white-space:nowrap
    }

    .item{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:12px;
      box-shadow:var(--shadow);
      margin-top:10px;
    }
    .itemHead{
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
    }
    .name{font-weight:900;line-height:1.2}
    .status{
      font-size:12px;font-weight:900;border-radius:999px;padding:6px 10px;
      border:1px solid var(--line); background:#fff;
      white-space:nowrap
    }
    .status.red{border-color:rgba(183,28,28,.4);background:rgba(183,28,28,.10);color:#7b1212}
    .status.amb{border-color:rgba(249,168,37,.45);background:rgba(249,168,37,.14);color:#6a4b00}
    .status.green{border-color:rgba(31,111,61,.35);background:rgba(31,111,61,.10);color:#0f4f2b}

    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px}
    @media (max-width:520px){ .grid3{grid-template-columns:1fr 1fr} }

    .kpi{
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      background:#f7f9fb;
    }
    .kpi .k{font-size:12px;color:var(--muted);font-weight:800}
    .kpi .v{font-size:16px;font-weight:900;margin-top:4px}

    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:rgba(17,17,17,0.92);color:#fff;
      padding:10px 12px;border-radius:12px;font-size:14px;
      max-width:92%;display:none;z-index:9999;white-space:pre-wrap
    }

    .reqBad{ border-color:#b71c1c !important; box-shadow:0 0 0 3px rgba(183,28,28,0.14); }
    .hint{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.25}
    .divider{height:1px;background:var(--line);margin:12px 0}
  </style>
</head>

<body>
<header>
  <div class="t">üì¶ –¢–í–û–ô –°–ö–õ–ê–î</div>
  <div class="sub">–û–¥–∏–Ω —Ä–∞–∑ –≤–≤–æ–¥–∏—à—å –ø–æ–∑—ã–≤–Ω–æ–π ‚Üí –¥–∞–ª—å—à–µ –≤—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ (–±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞).</div>
</header>

<div class="wrap">

  <div class="panel" id="authPanel">
    <div class="row">
      <div style="flex:2 1 220px">
        <label>–ü–æ–∑—ã–≤–Ω–æ–π (–æ–¥–∏–Ω —Ä–∞–∑)</label>
        <input id="callInput" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ë–ê–†–°-12" autocomplete="off"/>
        <div class="hint">–•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤—Ö–æ–¥ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π.</div>
      </div>
      <div style="flex:1 1 160px; display:flex; align-items:flex-end;">
        <button class="bBlue" id="btnLogin" type="button" style="width:100%;">–í–û–ô–¢–ò</button>
      </div>
    </div>
  </div>

  <div class="panel" id="mainPanel" style="display:none;">
    <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap;">
      <div>
        <div style="font-weight:900;font-size:16px" id="whoLine">–ü–æ–∑—ã–≤–Ω–æ–π: ‚Äî</div>
        <div class="metaLine" id="updatedLine">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –µ—â—ë –Ω–∏ —Ä–∞–∑—É –Ω–µ –±—ã–ª–æ.</div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
        <span class="badge" id="statsBadge">–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç: ‚Äî</span>
        <button class="bOutline tiny" id="btnLogout" type="button">–°–º–µ–Ω–∏—Ç—å –ø–æ–∑—ã–≤–Ω–æ–π</button>
      </div>
    </div>

    <div class="btnRow">
      <button class="bGreen" id="btnSaveAll" type="button" style="flex:2 1 240px;">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
      <button class="bBlue" id="btnOrderTG" type="button" style="flex:2 1 240px;">üì® –°–î–ï–õ–ê–¢–¨ –ó–ê–ö–ê–ó (Telegram)</button>
      <button class="bGray" id="btnHome" type="button" style="flex:1 1 160px;">‚Üê –î–û–ú–û–ô</button>
    </div>

    <div class="hint">
      –í –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤–≤–æ–¥–∏—à—å ‚Äú–µ—Å—Ç—å‚Äù. ‚Äú–ù—É–∂–Ω–æ‚Äù –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–∞–∫ —Ç—ã –ø–∏—Å–∞–ª). ‚Äú–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç‚Äù —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    </div>

    <div id="list"></div>

    <div class="divider"></div>

    <details class="panel" style="box-shadow:none;">
      <summary style="font-weight:900;cursor:pointer;">–≠–∫—Å–ø–æ—Ä—Ç / —Ä–µ–∑–µ—Ä–≤</summary>
      <div class="hint">–ï—Å–ª–∏ –Ω–∞–¥–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å–∫–ª–∞–¥ –Ω–∞ –¥—Ä—É–≥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON.</div>
      <div class="btnRow">
        <button class="bOutline" id="btnCopyJSON" type="button" style="flex:1 1 220px;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
        <button class="bOutline" id="btnImportJSON" type="button" style="flex:1 1 220px;">–ò–º–ø–æ—Ä—Ç JSON</button>
      </div>
      <label>–ü–æ–ª–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ (–≤—Å—Ç–∞–≤—å JSON –∏ –Ω–∞–∂–º–∏ ‚Äú–ò–º–ø–æ—Ä—Ç JSON‚Äù)</label>
      <input id="jsonBox" placeholder='{"items":{...},"updatedAt":...}' />
    </details>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (id)=>document.getElementById(id);
  const toastEl = $("toast");

  function toast(msg, ms=2000){
    toastEl.textContent = msg;
    toastEl.style.display="block";
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(()=>toastEl.style.display="none", ms);
  }

  // === Keys ===
  const ACTIVE_CALL_KEY = "medinv_active_call_v1"; // —Ç–µ–∫—É—â–∏–π –ø–æ–∑—ã–≤–Ω–æ–π
  const STORE_PREFIX = "medinv_store_v1__";        // –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–æ–∑—ã–≤–Ω–æ–º—É

  // === Catalog (—Ç–≤–æ–∏ –ø–æ–∑–∏—Ü–∏–∏) ===
  const CATALOG = [
    {id:"ceftriaxone", name:"–¶–µ—Ñ—Ç—Ä–∏–∞–∫—Å–æ–Ω", unit:"—Ñ–ª–∞–∫.", need:100},
    {id:"lido_water", name:"–õ–∏–¥–æ–∫–∞–∏–Ω/–Ω–æ–≤–æ–∫–∞–∏–Ω/–≤–æ–¥–∞ –¥–ª—è –∏–Ω—ä–µ–∫—Ü–∏–π", unit:"–∞–º–ø./—Ñ–ª–∞–∫.", need:50},
    {id:"ketorol_im", name:"–ö–µ—Ç–æ—Ä–æ–ª –≤/–º 30 –º–≥", unit:"–∞–º–ø.", need:20},
    {id:"dex", name:"–î–µ–∫—Å–∞–º–µ—Ç–∞–∑–æ–Ω 2‚Äì4 –º–≥", unit:"–∞–º–ø.", need:20},
    {id:"levomekol", name:"–õ–µ–≤–æ–º–µ–∫–æ–ª—å", unit:"—Ç—é–±.", need:20},
    {id:"syringes", name:"–®–ø—Ä–∏—Ü—ã 5/10 –º–ª", unit:"—à—Ç", need:100},
    {id:"ibuprofen", name:"–ò–±—É–ø—Ä–æ—Ñ–µ–Ω 400 –º–≥", unit:"—É–ø.", need:5},
    {id:"ketorol_tab", name:"–ö–µ—Ç–æ—Ä–æ–ª —Ç–∞–±–ª. 10 –º–≥", unit:"—É–ø.", need:5},
    {id:"theraflu", name:"–ü–æ—Ä–æ—à–∫–∏ –¢–µ—Ä–∞–§–ª—é/–∞–Ω–∞–ª–æ–≥–∏", unit:"–ø–∞–∫.", need:50},
    {id:"amoxicillin", name:"–ê–º–æ–∫—Å–∏—Ü–∏–ª–ª–∏–Ω (—Ç–∞–±–ª.)", unit:"—É–ø.", need:5},
    {id:"tourniquets", name:"–ñ–≥—É—Ç—ã", unit:"—à—Ç", need:5},
    {id:"bandage_7x14", name:"–ë–∏–Ω—Ç—ã 7√ó14", unit:"—à—Ç", need:20},
    {id:"omeprazole", name:"–û–º–µ–ø—Ä–∞–∑–æ–ª", unit:"—É–ø.", need:5},
    {id:"loperamide", name:"–õ–æ–ø–µ—Ä–∞–º–∏–¥", unit:"—É–ø.", need:5},
  ];

  // === State ===
  let activeCall = "";
  let store = null; // {items:{id:{have,need}}, updatedAt:number|null}

  function normCall(s){
    return (s||"").trim().toUpperCase();
  }
  function storeKey(call){
    return STORE_PREFIX + call;
  }
  function loadActiveCall(){
    try{ return normCall(localStorage.getItem(ACTIVE_CALL_KEY) || ""); }catch(_){ return ""; }
  }
  function saveActiveCall(call){
    localStorage.setItem(ACTIVE_CALL_KEY, call);
  }
  function clearActiveCall(){
    localStorage.removeItem(ACTIVE_CALL_KEY);
  }

  function defaultStore(){
    const items = {};
    for(const it of CATALOG){
      items[it.id] = {have:0, need:it.need};
    }
    return {items, updatedAt:null};
  }

  function loadStore(call){
    try{
      const raw = localStorage.getItem(storeKey(call));
      if(!raw) return defaultStore();
      const obj = JSON.parse(raw);
      if(!obj || typeof obj !== "object") return defaultStore();
      if(!obj.items || typeof obj.items !== "object") obj.items = {};
      // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
      for(const it of CATALOG){
        if(!obj.items[it.id] || typeof obj.items[it.id] !== "object"){
          obj.items[it.id] = {have:0, need:it.need};
        }else{
          if(!isFinite(+obj.items[it.id].have)) obj.items[it.id].have = 0;
          if(!isFinite(+obj.items[it.id].need)) obj.items[it.id].need = it.need;
        }
      }
      if(!("updatedAt" in obj)) obj.updatedAt = null;
      return obj;
    }catch(_){
      return defaultStore();
    }
  }

  function saveStore(){
    if(!activeCall || !store) return;
    localStorage.setItem(storeKey(activeCall), JSON.stringify(store));
  }

  function fmtDate(ts){
    if(!ts) return "–µ—â—ë –Ω–∏ —Ä–∞–∑—É –Ω–µ –±—ã–ª–æ.";
    const d = new Date(ts);
    const pad=(n)=>String(n).padStart(2,"0");
    return `${pad(d.getDate())}.${pad(d.getMonth()+1)}.${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }

  function calcMissing(itId){
    const it = store.items[itId];
    const have = Math.max(0, parseInt(it.have,10) || 0);
    const need = Math.max(0, parseInt(it.need,10) || 0);
    return Math.max(0, need - have);
  }

  function statusClass(missing, need){
    if(need <= 0) return "green";
    const ratio = missing / Math.max(need,1);
    if(missing <= 0) return "green";
    if(ratio >= 0.5) return "red";
    return "amb";
  }

  function render(){
    $("whoLine").textContent = "–ü–æ–∑—ã–≤–Ω–æ–π: " + activeCall;
    $("updatedLine").textContent = "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: " + fmtDate(store.updatedAt);

    const list = $("list");
    list.innerHTML = "";

    let totalMissing = 0;

    for(const it of CATALOG){
      const s = store.items[it.id];
      const have = Math.max(0, parseInt(s.have,10) || 0);
      const need = Math.max(0, parseInt(s.need,10) || 0);
      const missing = Math.max(0, need - have);
      totalMissing += missing;

      const cls = statusClass(missing, need);
      const dot = cls === "red" ? "üî¥" : (cls === "amb" ? "üü°" : "üü¢");

      const card = document.createElement("div");
      card.className = "item";

      card.innerHTML = `
        <div class="itemHead">
          <div class="name">${dot} ${it.name}</div>
          <div class="status ${cls}">–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç: ${missing} ${it.unit}</div>
        </div>

        <div class="grid3">
          <div class="kpi">
            <div class="k">–µ—Å—Ç—å (${it.unit})</div>
            <div class="v"><input inputmode="numeric" type="number" min="0" data-field="have" data-id="${it.id}" value="${have}"></div>
          </div>
          <div class="kpi">
            <div class="k">–Ω—É–∂–Ω–æ (${it.unit})</div>
            <div class="v"><input inputmode="numeric" type="number" min="0" data-field="need" data-id="${it.id}" value="${need}"></div>
          </div>
          <div class="kpi">
            <div class="k">–Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç</div>
            <div class="v">${missing} ${it.unit}</div>
          </div>
        </div>
      `;

      list.appendChild(card);
    }

    $("statsBadge").textContent = "–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç (—Å—É–º–º–∞): " + totalMissing;
  }

  function bindInputs(){
    $("list").addEventListener("input", (e)=>{
      const t = e.target;
      if(!t || t.tagName !== "INPUT") return;
      const id = t.getAttribute("data-id");
      const field = t.getAttribute("data-field");
      if(!id || !field) return;

      const v = Math.max(0, parseInt(t.value,10) || 0);
      store.items[id][field] = v;
      // –±–µ–∑ –∞–≤—Ç–æ—Å–µ–π–≤–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É ‚Äî –Ω–æ –ø–µ—Ä–µ—Ä–∏—Å—É–µ–º —Ä–∞—Å—á—ë—Ç —Å—Ä–∞–∑—É
      render();
    });
  }

  function requireCall(){
    if(!activeCall){
      toast("–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏ –ø–æ–∑—ã–≤–Ω–æ–π");
      return false;
    }
    return true;
  }

  function login(call){
    call = normCall(call);
    if(!call){
      $("callInput").classList.add("reqBad");
      toast("–í–≤–µ–¥–∏ –ø–æ–∑—ã–≤–Ω–æ–π");
      return;
    }
    $("callInput").classList.remove("reqBad");

    activeCall = call;
    saveActiveCall(activeCall);
    store = loadStore(activeCall);

    $("authPanel").style.display = "none";
    $("mainPanel").style.display = "block";
    render();
  }

  function logout(){
    clearActiveCall();
    activeCall = "";
    store = null;
    $("mainPanel").style.display = "none";
    $("authPanel").style.display = "block";
    $("callInput").value = "";
    toast("–ü–æ–∑—ã–≤–Ω–æ–π —Å–±—Ä–æ—à–µ–Ω");
  }

  function saveAll(){
    if(!requireCall()) return;
    store.updatedAt = Date.now();
    saveStore();
    render();
    toast("‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ");
  }

  function buildOrderText(){
    const lines = [];
    lines.push("üì¶ –ó–ê–ö–ê–ó / –ü–û–¢–†–ï–ë–ù–û–°–¢–¨");
    lines.push("–ü–æ–∑—ã–≤–Ω–æ–π: " + activeCall);
    lines.push("–û–±–Ω–æ–≤–ª–µ–Ω–æ: " + fmtDate(store.updatedAt));
    lines.push("");

    let any = false;
    for(const it of CATALOG){
      const s = store.items[it.id];
      const have = Math.max(0, parseInt(s.have,10) || 0);
      const need = Math.max(0, parseInt(s.need,10) || 0);
      const missing = Math.max(0, need - have);
      if(missing > 0){
        any = true;
        lines.push(`üî¥ ${it.name}`);
        lines.push(`–µ—Å—Ç—å: ${have} ${it.unit}, –Ω—É–∂–Ω–æ: ${need} ${it.unit}, –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç: ${missing} ${it.unit}`);
        lines.push("");
      }
    }
    if(!any){
      lines.push("üü¢ –ü–æ —Ç–µ–∫—É—â–∏–º –Ω–æ—Ä–º–∞–º –¥–µ—Ñ–∏—Ü–∏—Ç–∞ –Ω–µ—Ç.");
    }
    return lines.join("\n");
  }

  function sendOrderTelegram(){
    if(!requireCall()) return;

    // –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ—Ö—Ä–∞–Ω–∏–º (—á—Ç–æ–±—ã "–æ–±–Ω–æ–≤–ª–µ–Ω–æ" –±—ã–ª–æ —á–µ—Å—Ç–Ω—ã–º)
    store.updatedAt = Date.now();
    saveStore();
    render();

    const text = buildOrderText();
    const tgApp = "tg://msg_url?url=&text=" + encodeURIComponent(text);
    const tgWeb = "https://t.me/share/url?url=&text=" + encodeURIComponent(text);

    const a=document.createElement("a");
    a.href=tgApp;
    a.style.display="none";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    setTimeout(()=>{ try{ window.open(tgWeb, "_blank"); }catch(_){ } }, 700);
    toast("–û—Ç–∫—Ä—ã–≤–∞—é Telegram‚Ä¶", 1800);
  }

  function copyJSON(){
    if(!requireCall()) return;
    const json = JSON.stringify(store);
    navigator.clipboard.writeText(json).then(()=>toast("‚úÖ JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω")).catch(()=>toast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å", 2200));
  }

  function importJSON(){
    if(!requireCall()) return;
    const raw = ($("jsonBox").value || "").trim();
    if(!raw){ toast("–í—Å—Ç–∞–≤—å JSON –≤ –ø–æ–ª–µ", 2200); return; }
    try{
      const obj = JSON.parse(raw);
      if(!obj || typeof obj !== "object") throw new Error("bad");
      store = obj;
      // –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º
      if(!store.items || typeof store.items !== "object") store.items = {};
      for(const it of CATALOG){
        if(!store.items[it.id] || typeof store.items[it.id] !== "object"){
          store.items[it.id] = {have:0, need:it.need};
        }else{
          if(!isFinite(+store.items[it.id].have)) store.items[it.id].have = 0;
          if(!isFinite(+store.items[it.id].need)) store.items[it.id].need = it.need;
        }
      }
      if(!("updatedAt" in store)) store.updatedAt = null;
      saveStore();
      render();
      toast("‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ");
    }catch(_){
      toast("JSON –±–∏—Ç—ã–π / –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç", 2600);
    }
  }

  // === UI bindings ===
  $("btnLogin").addEventListener("pointerdown",(e)=>{ e.preventDefault(); login($("callInput").value); });
  $("callInput").addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ e.preventDefault(); login($("callInput").value); } });

  $("btnLogout").addEventListener("pointerdown",(e)=>{ e.preventDefault(); logout(); });
  $("btnSaveAll").addEventListener("pointerdown",(e)=>{ e.preventDefault(); saveAll(); });
  $("btnOrderTG").addEventListener("pointerdown",(e)=>{ e.preventDefault(); sendOrderTelegram(); });

  $("btnHome").addEventListener("pointerdown",(e)=>{
    e.preventDefault();
    // –¥–æ–º–æ–π = –∫–∞—Ä—Ç–∞ —Ä–∞–Ω–µ–Ω–∏–π
    window.location.href = "./index.html";
  });

  $("btnCopyJSON").addEventListener("pointerdown",(e)=>{ e.preventDefault(); copyJSON(); });
  $("btnImportJSON").addEventListener("pointerdown",(e)=>{ e.preventDefault(); importJSON(); });

  bindInputs();

  // === Auto-login ===
  activeCall = loadActiveCall();
  if(activeCall){
    store = loadStore(activeCall);
    $("authPanel").style.display = "none";
    $("mainPanel").style.display = "block";
    render();
  }else{
    $("authPanel").style.display = "block";
    $("mainPanel").style.display = "none";
  }
})();
</script>
</body>
</html>
